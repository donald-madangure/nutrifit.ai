

## üèÜ Project: AI Agentic Nutrition and Fitness Coach

**Tech Stack:** Next.js, Convex (Backend & DB), Clerk (Auth), Vapi (Voice AI), Groq/Llama 3.3 (LLM).

### üöÄ Technical Highlights

* **Voice-to-Schema Pipeline:** Engineered a system that transforms unstructured voice conversations into strict, validated JSON workout and diet plans.
* **Reactive State Management:** Utilized Convex‚Äôs power-syncing to update the user‚Äôs dashboard in real-time the moment the AI finishes generating a plan.
* **Infrastructure Security:** Implemented Svix webhook verification for Clerk and custom secret-header validation for Vapi endpoints.

---

## üõ† Hard Engineering Challenges I Solved

### 1. The "Hallucinating JSON" Problem

**Challenge:** LLMs often include conversational filler or incorrect keys that crash strict database schemas.
**Solution:** I built a **Validation & Sanitization Layer**. Instead of trusting the AI output, I pass it through a helper function that enforces defaults (e.g., 3 sets, 10 reps) and strips out any "hallucinated" fields before the database `insert` occurs.

### 2. Race Conditions in Identity Syncing

**Challenge:** Users might try to generate a plan the split-second they sign up, before the database has finished creating their user record.
**Solution:** I implemented an **Idempotent Sync Mutation**. Using Convex indexes on `clerkId`, I ensured that `syncUser` can be called multiple times safely, and the generation logic waits for a valid Convex `Id` before proceeding.

### 3. Latency Optimization

**Challenge:** Generating both a workout and a diet plan sequentially took ~4-5 seconds, which feels slow in a voice conversation.
**Solution:** I refactored the backend to use **Concurrent AI Execution** (`Promise.all`). By hitting the Groq API for the workout and diet plans simultaneously, I cut the total response time by nearly **50%**.

---

## üìà Future Scalability (What I'd do next)

* **Vector Search for Exercises:** Instead of the AI just typing "Squats," I would use a vector database to link the AI output to a library of high-quality exercise videos stored in Convex.
* **Cron Jobs for Reminders:** Use Convex `scheduler` to send automated diet reminders based on the meal times generated by the AI.

---

## üõ†Ô∏è Installation & Setup

### 1. Clone the Repository

```bash
git clone https://github.com/your-username/your-repo-name.git
cd your-repo-name
npm install

```

### 2. Environment Variables

Create a `.env.local` file for your frontend and a `.env` file in your `convex/` folder (or set them via the Convex Dashboard). You will need the following keys:

| Provider | Variable Name | Purpose |
| --- | --- | --- |
| **Clerk** | `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` | User Authentication |
| **Convex** | `CONVEX_DEPLOYMENT_URL` | Backend Connection |
| **Groq** | `GROQ_API_KEY` | Llama 3.3 Inference |
| **Vapi** | `VAPI_SECRET` | Voice AI Webhook Security |
| **Clerk** | `CLERK_WEBHOOK_SECRET` | Svix Webhook Verification |

### 3. Run the Development Server

```bash
# Terminal 1: Frontend
npm run dev

# Terminal 2: Convex Backend
npx convex dev

```

---

## üìñ Usage Guide

### Syncing Users

The app uses a **Clerk Webhook** to automatically provision users in the Convex database. Ensure your Clerk Dashboard points to `https://your-deployment.convex.site/clerk-webhook`.

### Generating a Program

1. **Initialize Voice:** Click the microphone icon to start a session with the Vapi Assistant.
2. **The Handshake:** Speak your fitness goals (e.g., *"I want a 4-day muscle-building plan, I'm a beginner, and I'm vegan"*).
3. **The Pipeline:** - Vapi sends a tool call to the `/vapi/generate-program` endpoint.
* The system fetches your `convexUserId` via your `clerkId`.
* Parallel Groq calls generate the Diet and Workout JSON.
* Data is validated and patched into the `plans` table.



---

## üß™ Testing the Webhooks Locally

Since webhooks require a public URL, I recommend using **Ngrok** to test the Vapi and Clerk integration on your local machine:

```bash
ngrok http 3000

```

Then, update your Clerk/Vapi dashboards with the Ngrok URL + the specific path (e.g., `/clerk-webhook`).

---
